<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myproject.caseNara.mapper.CustomerMapper">

    <insert id="insertCustomer" parameterType="com.myproject.caseNara.model.Customer" useGeneratedKeys="true" keyProperty="customerId">
        <selectKey keyProperty="customerId" resultType="long" order="BEFORE">
            SELECT NVL(MAX(CUSTOMER_ID), 0) + 1 FROM CUSTOMERS
        </selectKey>
        INSERT INTO CUSTOMERS (
            CUSTOMER_ID,
            COMPANY_NAME,
            PHONE,
            ADDRESS,
            DELETED
        ) VALUES (
            #{customerId,jdbcType=NUMERIC},
            #{companyName,jdbcType=VARCHAR},
            #{phone,jdbcType=VARCHAR},
            #{address,jdbcType=VARCHAR},
            0
        )
    </insert>

    <select id="findByCompanyName" parameterType="string" resultType="com.myproject.caseNara.model.Customer">
        SELECT 
            CUSTOMER_ID as customerId,
            COMPANY_NAME as companyName,
            PHONE as phone,
            ADDRESS as address,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM CUSTOMERS
        WHERE COMPANY_NAME = #{companyName}
          AND DELETED = 0
    </select>

    <select id="listCompanyNamesLike" parameterType="string" resultType="string">
        SELECT COMPANY_NAME
        FROM CUSTOMERS
        WHERE DELETED = 0
          AND COMPANY_NAME LIKE '%' || #{query} || '%'
          AND ROWNUM &lt;= 10
    </select>

    <select id="listAllCompanyNames" resultType="string">
        SELECT COMPANY_NAME
        FROM CUSTOMERS
        WHERE DELETED = 0
        ORDER BY COMPANY_NAME ASC
    </select>

    <!-- 모든 고객 조회 -->
    <select id="getAllCustomers" resultType="com.myproject.caseNara.model.Customer">
        SELECT 
            CUSTOMER_ID as customerId,
            COMPANY_NAME as companyName,
            PHONE as phone,
            ADDRESS as address,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM CUSTOMERS
        WHERE DELETED = 0
        ORDER BY COMPANY_NAME ASC
    </select>

    <!-- ID로 고객 조회 -->
    <select id="getCustomerById" parameterType="long" resultType="com.myproject.caseNara.model.Customer">
        SELECT 
            CUSTOMER_ID as customerId,
            COMPANY_NAME as companyName,
            PHONE as phone,
            ADDRESS as address,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM CUSTOMERS
        WHERE CUSTOMER_ID = #{customerId}
          AND DELETED = 0
    </select>

    <!-- 고객 정보 수정 -->
    <update id="updateCustomer" parameterType="com.myproject.caseNara.model.Customer">
        UPDATE CUSTOMERS
        SET 
            COMPANY_NAME = #{companyName,jdbcType=VARCHAR},
            PHONE = #{phone,jdbcType=VARCHAR},
            ADDRESS = #{address,jdbcType=VARCHAR}
        WHERE CUSTOMER_ID = #{customerId}
          AND DELETED = 0
    </update>

    <!-- 고객 삭제 (soft delete) -->
    <update id="deleteCustomer" parameterType="long">
        UPDATE CUSTOMERS
        SET 
            DELETED = 1
        WHERE CUSTOMER_ID = #{customerId}
          AND DELETED = 0
    </update>   

</mapper>