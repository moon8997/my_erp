<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myproject.caseNara.mapper.ProductMapper">
    <insert id="insertProduct" parameterType="com.myproject.caseNara.model.Product" useGeneratedKeys="true" keyProperty="productId">
        <selectKey keyProperty="productId" resultType="long" order="BEFORE">
            SELECT COALESCE(MAX(PRODUCT_ID), 0) + 1 FROM PRODUCTS
        </selectKey>
        INSERT INTO PRODUCTS (
            PRODUCT_ID,
            PRODUCT_NAME, 
            SALE_PRICE, 
            COST_PRICE, 
            IMAGE_URL,
            SUPPLIER,
            DISPLAY_LOCATION,
            DELETED
        ) VALUES (
            #{productId,jdbcType=NUMERIC},
            #{productName,jdbcType=VARCHAR}, 
            #{salePrice,jdbcType=NUMERIC}, 
            #{costPrice,jdbcType=NUMERIC}, 
            #{imageUrl,jdbcType=VARCHAR},
            #{supplier,jdbcType=VARCHAR},
            #{displayLocation,jdbcType=VARCHAR},
            0
        )
    </insert>
    
    <select id="getAllProducts" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            SUPPLIER as supplier,
            DISPLAY_LOCATION as displayLocation,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM 
            PRODUCTS 
        WHERE 
            DELETED = 0
    </select>
    
    <select id="getProductById" parameterType="long" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            SUPPLIER as supplier,
            DISPLAY_LOCATION as displayLocation,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM 
            PRODUCTS 
        WHERE 
            PRODUCT_ID = #{productId} 
            AND DELETED = 0
    </select>
    
    <update id="deleteProduct" parameterType="long">
        UPDATE PRODUCTS 
        SET 
            DELETED = 1
        WHERE 
            PRODUCT_ID = #{productId}
    </update>

    <update id="updateProduct" parameterType="com.myproject.caseNara.model.Product">
        UPDATE PRODUCTS 
        SET 
            PRODUCT_NAME = #{productName,jdbcType=VARCHAR}, 
            SALE_PRICE = #{salePrice,jdbcType=NUMERIC}, 
            COST_PRICE = #{costPrice,jdbcType=NUMERIC}, 
            IMAGE_URL = #{imageUrl,jdbcType=VARCHAR},
            SUPPLIER = #{supplier,jdbcType=VARCHAR},
            DISPLAY_LOCATION = #{displayLocation,jdbcType=VARCHAR}
        WHERE 
            PRODUCT_ID = #{productId,jdbcType=NUMERIC}
    </update>
    
    <select id="getProductByName" parameterType="string" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            SUPPLIER as supplier,
            DISPLAY_LOCATION as displayLocation,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM PRODUCTS
        WHERE PRODUCT_NAME = #{productName}
          AND DELETED = 0
    </select>
    
    <select id="listAllProductNames" resultType="string">
        SELECT PRODUCT_NAME
        FROM PRODUCTS
        WHERE DELETED = 0
        ORDER BY PRODUCT_NAME ASC
    </select>
    
    <select id="listProductNamesLike" parameterType="string" resultType="string">
        SELECT PRODUCT_NAME
        FROM PRODUCTS
        WHERE PRODUCT_NAME LIKE '%' || #{query} || '%'
          AND DELETED = 0
        ORDER BY PRODUCT_NAME ASC
    </select>

    <!-- 모든 상품 이미지 URL 목록 조회 (NULL 제외, 삭제되지 않은 항목) -->
    <select id="listAllImageUrls" resultType="string">
        SELECT IMAGE_URL
        FROM PRODUCTS
        WHERE IMAGE_URL IS NOT NULL
          AND DELETED = 0
    </select>
</mapper>