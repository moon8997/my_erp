<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myproject.caseNara.mapper.ProductMapper">
    <insert id="insertProduct" parameterType="com.myproject.caseNara.model.Product" useGeneratedKeys="true" keyProperty="productId">
        <selectKey keyProperty="productId" resultType="long" order="BEFORE">
            SELECT NVL(MAX(PRODUCT_ID), 0) + 1 FROM PRODUCTS
        </selectKey>
        INSERT INTO PRODUCTS (
            PRODUCT_ID,
            PRODUCT_NAME, 
            SALE_PRICE, 
            COST_PRICE, 
            IMAGE_URL, 
            DELETED
        ) VALUES (
            #{productId,jdbcType=NUMERIC},
            #{productName}, 
            #{salePrice}, 
            #{costPrice}, 
            #{imageUrl}, 
            0
        )
    </insert>
    
    <select id="getAllProducts" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM 
            PRODUCTS 
        WHERE 
            DELETED = 0
    </select>
    
    <select id="getProductById" parameterType="long" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM 
            PRODUCTS 
        WHERE 
            PRODUCT_ID = #{productId} 
            AND DELETED = 0
    </select>
    
    <update id="deleteProduct" parameterType="long">
        UPDATE PRODUCTS 
        SET 
            DELETED = 1
        WHERE 
            PRODUCT_ID = #{productId}
    </update>
    
    <update id="updateProduct" parameterType="com.myproject.caseNara.model.Product">
        UPDATE PRODUCTS 
        SET 
            PRODUCT_NAME = #{productName}, 
            SALE_PRICE = #{salePrice}, 
            COST_PRICE = #{costPrice}, 
            IMAGE_URL = #{imageUrl}
        WHERE 
            PRODUCT_ID = #{productId}
    </update>
    
    <select id="getProductByName" parameterType="string" resultType="com.myproject.caseNara.model.Product">
        SELECT 
            PRODUCT_ID as productId,
            PRODUCT_NAME as productName,
            SALE_PRICE as salePrice,
            COST_PRICE as costPrice,
            IMAGE_URL as imageUrl,
            CREATED_AT as createdAt,
            UPDATED_AT as updatedAt,
            DELETED as deleted
        FROM PRODUCTS
        WHERE PRODUCT_NAME = #{productName}
          AND DELETED = 0
    </select>
    
    <select id="listAllProductNames" resultType="string">
        SELECT PRODUCT_NAME
        FROM PRODUCTS
        WHERE DELETED = 0
        ORDER BY PRODUCT_NAME ASC
    </select>
    
</mapper>